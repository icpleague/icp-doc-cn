<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Actors and async data :: Motoko documentation</title>
    <meta name="generator" content="Antora 3.0.1">
<link rel="stylesheet" href="../../_/css/site.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" /><meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:title" content="Internet Computer | Documentation" />
<meta property="og:description" content="Documentation for the internet computer." />
<meta property="og:image" content="../../_/img/share.jpg" />
<meta property="og:image:url" content="../../_/img/share.jpg" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@DFINITYDev" />
<meta name="twitter:image" content="../../_/img/logo-RGB.png" />
<meta name="twitter:image:alt" content="ICPL Logo" />
    <script>
        if (location.hostname === 'sdk.dfinity.org') {
            location.replace(location.href.replace("sdk.dfinity.org","smartcontracts.org"));
        }
    </script>


    <!-- Appzi: Capture Insightful Feedback -->
    <script async src="https://w.appzi.io/w.js?token=Zrf92"></script>
    <!-- End Appzi -->

    <link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<script>
  function switchToLightMode(persist) {
    document.querySelector("body").classList.remove("dark-mode");
    if (persist) {
      localStorage.setItem("theme-preference", "light");
    }
  }
  function switchToDarkMode(persist) {
    document.querySelector("body").classList.add("dark-mode");
    if (persist) {
      localStorage.setItem("theme-preference", "dark");
    }
  }

  var themePreference = localStorage.getItem("theme-preference");

  if (themePreference == "dark") {
    switchToDarkMode(false);
  } else if (themePreference == "light") {
    switchToLightMode(false);
  } else {
    // dark mode by default
    switchToDarkMode(false);

    // uncomment to enable setting the defult by user preference
    // try {
    //   if (
    //     window.matchMedia &&
    //     window.matchMedia("(prefers-color-scheme: dark)").matches
    //   ) {
    //     switchToDarkMode(false);
    //   }
    // } catch {}
  }
</script>
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="logo-container" href="/icp-docs-cn/docs/introduction/welcome.html">
        <img class="header-logo" src="../../_/img/logo.svg">
        <img class="header-logo dark" src="../../_/img/logo-dark.svg">
        <h1 class="header-title">Motoko documentation</h1>
      </a>
    </div>
    <div id="topbar-nav" class="navbar-menu">
          <!--<a class="navbar-item" target="blank" href="https://dfinity.org/">DFINITY.org</a>-->
          <a class="navbar-item" target="blank" href="https://icpleague.com/">论坛</a>
          <!--<a class="navbar-item" target="blank" href="mailto:support@dfinity.org?subject=Feedback - SDK Developer Center">Email us</a>-->
          <!--<a class="navbar-item" target="blank" href="https://support.dfinity.org/">Support</a>          -->
          <a class="navbar-item" target="blank" href="https://twitter.com/icpleague_com">
            <img class="light-only" src="../../_/img/social/twitter-icon.svg">
            <img class="dark-only" src="../../_/img/social/twitter-icon-dark.svg">
          </a>
      </div>
    <div class="nav-items-wrapper">
      <button class="to-light-mode dark-only" aria-label="switch to light mode" onclick="switchToLightMode(true)"></button>
      <button class="to-dark-mode light-only" aria-label="switch to dark mode" onclick="switchToDarkMode(true)"></button>
      <div class="search-container">
  <svg class="search-icon" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path fill-rule="evenodd" clip-rule="evenodd"
      d="M11.8654 12.5892C10.8213 13.4695 9.47259 14 8 14C4.68629 14 2 11.3137 2 8C2 4.68629 4.68629 2 8 2C11.3137 2 14 4.68629 14 8C14 9.47209 13.4699 10.8204 12.5901 11.8643L17.3625 16.6367L16.6377 17.3615L11.8654 12.5892ZM12.9333 8C12.9333 10.7246 10.7246 12.9333 8 12.9333C5.2754 12.9333 3.06667 10.7246 3.06667 8C3.06667 5.2754 5.2754 3.06667 8 3.06667C10.7246 3.06667 12.9333 5.2754 12.9333 8Z"
      fill="black" />
  </svg>


  <input class="search-input" placeholder="Search" type="search" />
</div>      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
      </div>

      <!--这是彩色的阴影条-->
    <!--<div class="gradient-decoration"></div>-->
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="docs" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title">Docs</h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../introduction/welcome.html"><strong>介绍</strong></a>

<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction/welcome.html#for-first-timers">适合: 初学者</a>

  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction/welcome.html#for-developers">适合: 开发者</a>

  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction/welcome.html#for-protocol-enthusiasts">适合: 协议爱好者</a>

  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../quickstart/quickstart-intro.html">快速开始</a>

<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../quickstart/how-to-deploy-hello-world-smart-contract.html">20分钟部署第一个DAPP</a>

  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../quickstart/cycles-faucet.html">获取免费的Cycles</a>

  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../examples/index.html">示例代码</a>

<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../examples/hello.html">Hello示例</a>

  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../examples/host-a-website.html">托管静态网站</a>

  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../examples/dex.html">基本的DEX</a>

  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../examples/nft.html">铸造NFT</a>

  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../examples/dao.html">基本的DAO</a>

  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../examples/encrypted-notes.html">加密笔记</a>

  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../examples/tokentransfer.html">代币转账</a>

  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">开发者文档</span>

<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">入门</span>

<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">SDK介绍</span>

<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../developers-guide/install-upgrade-remove.html">安装、升级或删除软件</a>

  </li>
  <li class="nav-item" data-depth="4">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../release-notes/sdk-release-notes.html">Release notes</a>

<ul class="nav-list">
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../release-notes/0.9.2-rn.html">0.9.2</a>

  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../release-notes/0.9.0-rn.html">0.9.0</a>

  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../release-notes/0.8.4-rn.html">0.8.4</a>

  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../release-notes/0.8.3-rn.html">0.8.3</a>

  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../release-notes/0.8.2-rn.html">0.8.2</a>

  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../release-notes/0.8.1-rn.html">0.8.1</a>

  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../release-notes/0.8.0-rn.html">0.8.0</a>

  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../release-notes/0.7.7-rn.html">0.7.7</a>

  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../release-notes/0.7.2-rn.html">0.7.2</a>

  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../release-notes/0.7.1-rn.html">0.7.1</a>

  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../release-notes/0.7.0-rn.html">0.7.0</a>

  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../release-notes/0.6.26-rn.html">0.6.26</a>

  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../release-notes/0.6.25-rn.html">0.6.25</a>

  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../release-notes/0.6.24-rn.html">0.6.24</a>

  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../release-notes/0.6.23-rn.html">0.6.23</a>

  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../release-notes/0.6.22-rn.html">0.6.22</a>

  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../release-notes/0.6.21-rn.html">0.6.21</a>

  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../release-notes/0.6.20-rn.html">0.6.20</a>

  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">DFX介绍</span>

<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../developers-guide/cli-reference.html">DFX命令</a>

  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../developers-guide/cli-reference/dfx-envars.html">DFX环境变量</a>

  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../developers-guide/glossary.html">术语表</a>

  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">在互联网计算机上构建</span>

<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">了解如何构建:</span>

<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../developers-guide/sdk-guide.html">在IC上开发智能合约</a>

  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../developers-guide/design-apps.html">设计应用程序</a>

  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../developers-guide/customize-projects.html">管理项目</a>

  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../developers-guide/working-with-canisters.html">管理容器</a>

  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../developers-guide/default-wallet.html">使用默认的cycles钱包</a>

  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../developers-guide/tutorials/explore-templates.html">探索默认项目</a>

  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../developers-guide/tutorials/define-an-actor.html">使用actor查询</a>

  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../developers-guide/tutorials/hello-location.html">传递text参数</a>

  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../developers-guide/tutorials/counter-tutorial.html">递增自然数</a>

  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../developers-guide/tutorials/calculator.html">在计算器函数中使用整型</a>

  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../developers-guide/tutorials/phonebook.html">导入库模块</a>

  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../developers-guide/tutorials/multiple-actors.html">使用多个actor</a>

  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../developers-guide/tutorials/intercanister-calls.html">进行canister之间调用</a>

  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../developers-guide/tutorials/access-control.html">使用身份添加访问控制</a>

  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../developers-guide/tutorials/simple-cycles.html">从钱包接受cycles</a>

  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../developers-guide/tutorials/reproducible-builds.html">可重复地构建容器</a>

  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../developers-guide/troubleshooting.html">故障排查</a>

  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">探索开发语言</span>

<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../developers-guide/work-with-languages.html">使用不同的语言进行开发</a>

  </li>
  <li class="nav-item" data-depth="4">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="motoko.html">Motoko</a>

<ul class="nav-list">
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="https://m7sm4-2iaaa-aaaab-qabra-cai.raw.ic0.app/">Motoko在线环境</a>

  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="#base-libraries:stdlib-intro.adoc">Motoko基础库</a>

  </li>
  <li class="nav-item" data-depth="5">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Motoko Guide</span>

<ul class="nav-list">
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="about-this-guide.html">关于本指南</a>

  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="motoko-introduction.html">介绍</a>

  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="basic-concepts.html">基本概念和术语</a>

  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="mutable-state.html">可变状态</a>

  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="local-objects-classes.html">本地对象和类</a>

  </li>
  <li class="nav-item is-current-page" data-depth="6">
    <a class="nav-link" href="actors-async.html">Actors和异步数据</a>

  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="errors.html">错误处理</a>

  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="pattern-matching.html">模式匹配</a>

  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="sharing.html">共享数据和行为</a>

  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="modules-and-imports.html">模块和导入</a>

  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="control-flow.html">(命令式)控制流</a>

  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="structural-equality.html">结构方程(平等)</a>

  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="actor-classes.html">Actor类</a>

  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="caller-id.html">Principals和调用者身份</a>

  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="cycles.html">管理cycles</a>

  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="upgrades.html">稳定变量与upgrade方法</a>

  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="compatibility.html">更新升级的兼容性</a>

  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="stablememory.html">稳定存储(实验性)</a>

  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="heartbeats.html">心跳机制(定时任务)</a>

  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="language-manual.html">语言速览手册</a>

  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="compiler-ref.html">编译器手册</a>

  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="motoko-grammar.html">Motoko语法</a>

  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="overview.html">Motoko简介</a>

  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="style.html">Motoko编程规范</a>

  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="4">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#rust-guide:rust-intro.adoc">Rust</a>

<ul class="nav-list">
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="#rust-guide:rust-quickstart.adoc">快速开始</a>

  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="#rust-guide:rust-counter.adoc">简单的计数器</a>

  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="#rust-guide:multiply-dependency.adoc">基础依赖</a>

  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="#rust-guide:rust-profile.adoc">简介</a>

  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="#rust-guide:rust-optimize.adoc">优化Rust程序</a>

  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="4">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#candid-guide:candid-intro.adoc">Candid</a>

<ul class="nav-list">
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="#candid-guide:candid-concepts.adoc">什么是Candid?</a>

  </li>
  <li class="nav-item" data-depth="5">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#candid-guide:candid-howto.adoc">如何使用</a>

<ul class="nav-list">
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="#candid-guide:candid-types.adoc">支持的类型</a>

  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="https://github.com/dfinity/candid">Candid规范</a>

  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="https://docs.rs/candid">Candid的Rust库</a>

  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">介绍互联网身份</span>

<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="#ic-identity-guide:what-is-ic-identity.adoc">什么是互联网身份</a>

  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="#ic-identity-guide:auth-how-to.adoc">如何使用互联网身份</a>

  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="#ic-identity-guide:hello-guide.adoc">Windows Hello指南</a>

  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">前端开发</span>

<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../developers-guide/webpack-config.html">添加前端资源</a>

  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../developers-guide/tutorials/custom-frontend.html">自定义前端</a>

  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../developers-guide/tutorials/my-contacts.html">添加CSS样式</a>

  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Security Best Practices</span>

<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../security-best-practices/introduction.html">Introduction</a>

  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../security-best-practices/general-security-best-practices.html">General Security Best Practices</a>

  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../security-best-practices/web-app-development-security-best-practices.html">Web App Development Security Best Practices</a>

  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../security-best-practices/rust-canister-development-security-best-practices.html">Rust Canister Development Security Best Practices</a>

  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">协议文档</span>

<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../developers-guide/concepts/concepts-intro.html">概念</a>

<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../developers-guide/concepts/what-is-IC.html">什么是IC(互联网计算机)</a>

  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#interface-spec:index.adoc">互联网计算机接口规范</a>

  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../developers-guide/concepts/nodes-subnets.html">节点和子网络</a>

  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../developers-guide/concepts/data-centers.html">去中心化数据中心</a>

  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../developers-guide/concepts/canisters-code.html">Canister和代码</a>

  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../developers-guide/concepts/trust-in-canisters.html">信任canister</a>

  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../developers-guide/concepts/tokens-cycles.html">代币和cycles</a>

  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../developers-guide/concepts/governance.html">神经元和治理</a>

  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../developers-guide/concepts/bitcoin-integration.html">比特币整合</a>

  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">通用文档</span>

<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Overview of self-custody</span>

<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../token-holders/custody-options-intro.html">Choosing self-custody for digital assets</a>

  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../token-holders/self-custody-quickstart.html">Self-custody quick start</a>

  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">账本概述</span>

<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../integration/ledger-quick-start.html">账本快速开始</a>

  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">NNS概述</span>

<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../token-holders/nns-app-quickstart.html">NNS应用快速开始</a>

  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">其他资源</span>

<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">开发者视频</span>

<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <span class="nav-text"><a href="https://www.youtube.com/watch?v=oxEr8UzGeBo&amp;list=PLuhDt1vhGcrf4DgKZecU3ar_RA1cB0vUT&amp;index=11&amp;ab_channel=DFINITY" target="_blank" rel="noopener">Internet Identity</a></span>

  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-text"><a href="https://www.youtube.com/watch?v=4eSceDOS-Ms&amp;list=PLuhDt1vhGcrf4DgKZecU3ar_RA1cB0vUT&amp;index=21&amp;ab_channel=DFINITY" target="_blank" rel="noopener">Motoko</a></span>

  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-text"><a href="https://www.youtube.com/watch?v=GzkRsbqPaA0&amp;ab_channel=DFINITY" target="_blank" rel="noopener">Building a multiplayer game for the Internet Computer</a></span>

  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-text"><a href="https://www.youtube.com/watch?v=b_nc6yx5_DQ&amp;list=PLuhDt1vhGcrf4DgKZecU3ar_RA1cB0vUT&amp;index=7&amp;ab_channel=DFINITY" target="_blank" rel="noopener">Deploying static sites to the Internet Computer</a></span>

  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-text"><a href="https://www.youtube.com/watch?v=2miweY9-vZc&amp;list=PLuhDt1vhGcrf4DgKZecU3ar_RA1cB0vUT&amp;index=6&amp;ab_channel=DFINITY" target="_blank" rel="noopener">Zero to fullstack: web apps on the Internet Computer </a></span>

  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">协议视频</span>

<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <span class="nav-text"><a href="https://dfinity.org/technicals/" target="_blank" rel="noopener">Technical library</a></span>

  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">开发者工具</span>

<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../download.html">DFINITY Canister SDK</a>

  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-text"><a href="https://github.com/dfinity/cdk-rs" target="_blank" rel="noopener">Rust CDK</a></span>

  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-text"><a href="https://github.com/kritzcreek/vessel" target="_blank" rel="noopener">Vessel Package Manager</a></span>

  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-text"><a href="https://marketplace.visualstudio.com/items?itemName=dfinity-foundation.vscode-motoko" target="_blank" rel="noopener">Motoko VS Code Extension</a></span>

  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-text"><a href="https://github.com/dfinity/agent-js" target="_blank" rel="noopener">Agent JS</a></span>

  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-text"><a href="https://github.com/sudograph/sudograph" target="_blank" rel="noopener">Sudograph</a></span>

  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-text"><a href="https://github.com/dfinity/cycles-wallet" target="_blank" rel="noopener">Cycles Wallet</a></span>

  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-text"><a href="https://m7sm4-2iaaa-aaaab-qabra-cai.raw.ic0.app/" target="_blank" rel="noopener">Motoko Playground</a></span>

  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-text"><a href="https://github.com/dfinity/quill" target="_blank" rel="noopener">Quill</a></span>

  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">社区资源</span>

<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <span class="nav-text"><a href="https://ic.rocks/" target="_blank" rel="noopener">ic.rocks (Block explorer)</a></span>

  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-text"><a href="https://plugwallet.ooo/" target="_blank" rel="noopener">Plug (Browser-based wallet extension)</a></span>

  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-text"><a href="https://fleek.co/" target="_blank" rel="noopener">Fleek (Netlify for the open web)</a></span>

  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-text"><a href="http://faucet.dfinity.org/" target="_blank" rel="noopener">Cycles Faucet</a></span>

  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../developers-guide/computation-and-storage-costs.html">Computation and Storage Costs</a>

  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">社区</span>

<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-text"><a href="https://discord.gg/cA7y6ezyE2" target="_blank" rel="noopener">Developer Discord</a></span>

  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text"><a href="https://forum.dfinity.org/" target="_blank" rel="noopener">Developer Forum</a></span>

  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Developer Center</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Developer Center</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="../index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main>
<div class="toolbar" role="navigation">
<button class="nav-toggle">Table of contents</button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Developer Center</a></li>
    <li>开发者文档</li>
    <li>在互联网计算机上构建</li>
    <li>探索开发语言</li>
    <li><a href="motoko.html">Motoko</a></li>
    <li>Motoko Guide</li>
    <li><a href="actors-async.html">Actors和异步数据</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/icpleague/icp-docs-cn/edit/main/doc/modules/language-guide/pages/actors-async.adoc"><svg class="edit-icon" xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/><path d="M0 0h24v24H0z" fill="none"/></svg></a></div>
  </div>
<div class="main-content">
<article class="doc">
<h1 class="page">Actors and async data</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The programming model of the Internet Computer consists of memory-isolated canisters communicating by asynchronous message passing of binary data encoding Candid values.
A canister processes its messages one-at-a-time, preventing race conditions.
A canister uses call-backs to register what needs to be done with the result of any inter-canister messages it issues.</p>
</div>
<div class="paragraph">
<p>Motoko abstracts the complexity of the Internet Computer with a well known, higher-level abstraction: the <em>actor model</em>.
Each canister is represented as a typed actor. The type of an actor lists the messages
it can handle. Each message is abstracted as a typed, asynchronous function.
A translation from actor types to Candid types imposes structure on the raw binary data of the underlying Internet Computer.
An actor is similar to an object, but is different in that its state is completely isolated,
its interactions with the world are entirely through asynchronous messaging, and its messages are processed one-at-a-time, even when issued in parallel by concurrent actors.</p>
</div>
<div class="paragraph">
<p>In Motoko, sending a message to an actor is a function call, but instead of
blocking the caller until the call has returned, the message is enqueued
on the callee, and a <em>future</em> representing that pending request
immediately returned to the caller.  The future is a placeholder for the eventual result
of the request, that the caller can later query. Between issuing the
request, and deciding to wait for the result, the caller is free to do
other work, including issuing more requests to the same or other
actors.
Once the callee has processed the request, the future is completed and its result made
available to the caller.
If the caller is waiting on the future, its execution can resume with the result, otherwise the result is simply stored in the future for later use.</p>
</div>
<div class="paragraph">
<p>In Motoko, actors have dedicated syntax and types; messaging is handled by so called <em>shared</em> functions returning futures (shared because they are available to remote actors);
a future, <code>f</code>, is a value of the special type <code>async T</code> for some type <code>T</code>; waiting
on <code>f</code> to be completed is expressed using <code>await f</code> to obtain a value of type <code>T</code>.
To avoid introducing shared state through messaging, for example, by sending an object or mutable array,
the data that can be transmitted through shared functions is restricted to immutable, <em>shared</em> types.</p>
</div>
<div class="paragraph">
<p>To start, we consider the simplest stateful service: a <code>Counter</code> actor, the distributed version of our previous, local <code>counter</code> object.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_example_a_counter_service"><a class="anchor" href="#_example_a_counter_service"></a>Example: a Counter service</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Consider the following actor declaration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">actor Counter {

  var count = 0;

  public shared func inc() : async () { count += 1 };

  public shared func read() : async Nat { count };

  public shared func bump() : async Nat {
    count += 1;
    count;
  };
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Counter</code> actor declares one field and three public, <em>shared</em> functions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the field <code>count</code> is mutable, initialized to zero and implicitly <code>private</code>.</p>
</li>
<li>
<p>function <code>inc()</code> asynchronously increments the counter and returns a future of type <code>async ()</code> for synchronization.</p>
</li>
<li>
<p>function <code>read()</code> asynchronously reads the counter value and returns a future of type <code>async Nat</code> containing its value.</p>
</li>
<li>
<p>function <code>bump()</code> asynchronously increments and reads the counter.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Shared functions, unlike local functions, are accessible to remote callers and have additional restrictions: their arguments and return value must be <em>shared</em> types - a subset of types that includes immutable data, actor references, and shared function references, but excludes
references to local functions and mutable data. Because all interaction with actors is asynchronous,
an actor&#8217;s functions must return futures, that is, types of the form <code>async T</code>, for some type <code>T</code>.</p>
</div>
<div class="paragraph">
<p>The only way to read or modify the state (<code>count</code>) of the <code>Counter</code> actor is through its shared functions.</p>
</div>
<div class="paragraph">
<p>A value of type <code>async T</code> is a future. The producer of the future
completes the future when it returns a result, either a value or error.</p>
</div>
<div class="paragraph">
<p>Unlike objects and modules, actors can only expose functions, and these functions must be <code>shared</code>. For this reason, Motoko allows you to omit the <code>shared</code> modifier on public actor functions, allowing the more concise, but equivalent, actor declaration:</p>
</div>
<div id="counter" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">actor Counter {

  var count = 0;

  public func inc() : async () { count += 1 };

  public func read() : async Nat { count };

  public func bump() : async Nat {
    count += 1;
    count;
  };
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>For now, the only place shared functions can be declared is in the
body of an actor or actor class.  Despite this restriction, shared
functions are still first-class values in Motoko and can be passed
as arguments or results, and stored in data structures.</p>
</div>
<div class="paragraph">
<p>The type of a shared function is specified using a shared function type. For example, the
value <code>inc</code> has type <code>shared () &#8594; async Nat</code> and could be supplied
as a standalone callback to some other service (see <a href="sharing.html">publish-subscribe</a> for an example).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_actor_types"><a class="anchor" href="#_actor_types"></a>Actor types</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Just as objects have object types, actors have <em>actor types</em>. The
<code>Counter</code> actor has the following type:</p>
</div>
<div class="listingblock no-repl">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">actor {
  inc  : shared () -&gt; async ();
  read : shared () -&gt; async Nat;
  bump : shared () -&gt; async Nat;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Again, because the <code>shared</code> modifier is required on every member of an actor,
Motoko both elides them on display, and allows you to omit them
when authoring an actor type.</p>
</div>
<div class="paragraph">
<p>Thus the previous type can be expressed more succinctly as:</p>
</div>
<div class="listingblock no-repl">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">actor {
  inc  : () -&gt; async ();
  read : () -&gt; async Nat;
  bump : () -&gt; async Nat;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Like object types, actor types support subtyping: an actor type is a subtype of a more general one that offers fewer functions with more general types.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_await_to_consume_async_futures"><a class="anchor" href="#_using_await_to_consume_async_futures"></a>Using <code>await</code> to consume async futures</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The caller of a shared function typically receives a future, a value of type <code>async T</code> for some T.</p>
</div>
<div class="paragraph">
<p>The only thing the caller, a consumer, can do with this future is
wait for it to be completed by the producer, throw it away, or store
it for later use.</p>
</div>
<div class="paragraph">
<p>To access the result of an <code>async</code> value, the receiver of the future use an  <code><strong>await</strong></code> expression.</p>
</div>
<div class="paragraph">
<p>For example, to use the result of <code>Counter.read()</code> above, we can first bind the
future to an identifier <code>a</code>, and then <code>await a</code> to retrieve the underlying <code>Nat</code>, <code>n</code>:</p>
</div>
<div class="listingblock include_counter">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">let a : async Nat = Counter.read();
let n : Nat = await a;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first line immediately receives <em>a future of the counter value</em>, but does not wait for it, and thus cannot (yet) use it as a natural number.</p>
</div>
<div class="paragraph">
<p>The second line <code>await</code>s this future and extracts the result, a natural number.
This line may suspend execution until the future has been completed.</p>
</div>
<div class="paragraph">
<p>Typically, one rolls the two steps into one and one just awaits an asynchronous call directly:</p>
</div>
<div class="listingblock include_counter">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">let n : Nat = await Counter.read();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Unlike a local function call, which blocks the caller until the callee has returned a result,
a shared function call immediately returns a future, <code>f</code>, without blocking.
Instead of blocking, a later call to <code>await f</code> suspends the current computation until <code>f</code> is complete.
Once the future is completed (by the producer), execution of <code>await p</code> resumes with its result.
If the result is a value, <code>await f</code> returns that value.
Otherwise the result is some error, and <code>await f</code> propagates the error to the
consumer of <code>await f</code>.</p>
</div>
<div class="paragraph">
<p>Awaiting a future a second time will just produce the same result, including re-throwing any error stored in the future.
Suspension occurs even if the future is already complete; this ensures state changes and message sends prior to <em>every</em> <code>await</code> are committed.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
A function that does not <code>await</code> in its body is guaranteed to
execute atomically - in particular, the environment cannot change the
state of the actor while the function is executing.  If a function
performs an <code>await</code>, however, atomicity is no longer guaranteed.
Between suspension and resumption around the <code>await</code>, the state of the
enclosing actor may change due to concurrent processing of other
incoming actor messages. It is the programmer&#8217;s responsibility to
guard against non-synchronized state changes. A programmer may,
however, rely on any state change prior to the await being committed.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example, the implementation of <code>bump()</code> above is guaranteed to increment and read the
value of <code>count</code>, in one atomic step. The alternative implementation:</p>
</div>
<div class="listingblock no-repl">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">  public shared func bump() : async Nat {
    await inc();
    await read();
  };</code></pre>
</div>
</div>
<div class="paragraph">
<p>does <em>not</em> have the same semantics and allows another client of the actor to
interfere with its operation: each <code>await</code> suspends execution, allowing an interloper
to change the state of the actor.
By design, the explicit <code>await</code>s make the potential points of interference clear to the reader.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_traps_and_commit_points"><a class="anchor" href="#_traps_and_commit_points"></a>Traps and Commit Points</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A trap is a non-recoverable runtime failure caused by, for example, division-by-zero,  out-of-bounds array indexing, numeric overflow, cycle exhaustion or assertion failure.</p>
</div>
<div class="paragraph">
<p>A shared function call that executes without executing an <code>await</code> expression
never suspends and executes atomically.
A shared function that contains no <code>await</code> expression is syntactically atomic.</p>
</div>
<div class="paragraph">
<p>An atomic shared function whose execution traps has no
visible effect on the state of the enclosing actor or its environment
- any state change is reverted, and any message that it has sent is
revoked.  In fact, all state changes and message sends are tentative
during execution: they are committed only after a successful <em>commit
point</em> is reached.</p>
</div>
<div class="paragraph">
<p>The points at which tentative state changes and message sends are irrevocably
committed are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>implicit exit from a shared function by producing a result,</p>
</li>
<li>
<p>explict exit via <code>return</code> or <code>throw</code> expressions, and</p>
</li>
<li>
<p>explicit <code>await</code> expressions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A trap will only revoke changes made since the last commit point.  In
particular, in a non-atomic function that does multiple awaits, a trap
will only revoke changes attempted since the last await - all preceding effects
will have been committed and cannot be undone.</p>
</div>
<div class="paragraph">
<p>For example, consider the following (contrived) stateful <code>Atomicity</code> actor:</p>
</div>
<div class="listingblock no-repl">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">actor Atomicity {

  var s = 0;
  var pinged = false;

  public func ping() : async () {
    pinged := true;
  };

  // an atomic method
  public func atomic() : async () {
    s := 1;
    ignore ping();
    ignore 0/0; // trap!
  };

  // a non-atomic method
  public func nonAtomic() : async () {
    s := 1;
    let f = ping(); // this will not be rolled back!
    s := 2;
    await f;
    s := 3; // this will not be rolled back!
    await f;
    ignore 0/0; // trap!
  };

};</code></pre>
</div>
</div>
<div class="paragraph">
<p>Calling (shared) function <code>atomic()</code> will fail with an error, since the last statement causes a trap.
However, the trap leaves the mutable variable <code>s</code> with value <code>0</code>, not <code>1</code>, and variable <code>pinged</code> with value <code>false</code>, not <code>true</code>.
This is because the trap happens <em>before</em> method <code>atomic</code> has executed an <code>await</code>, or exited with a result.
Even though <code>atomic</code> calls <code>ping()</code>, <code>ping()</code> is tentative (queued) until the next commit point, so never delivered.</p>
</div>
<div class="paragraph">
<p>Calling (shared) function <code>nonAtomic()</code> will fail with an error, since the last statement causes a trap.
However, the trap leaves the variable <code>s</code> with value <code>3</code>, not <code>0</code>, and variable <code>pinged</code> with value <code>true</code>, not <code>false</code>.
This is because each <code>await</code> commits its preceding side-effects, including message sends.
Even though <code>f</code> is complete by the second await on <code>f</code>, this await also forces a commit of the state, suspends execution and allows for
interleaved processing of other messages to this actor.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_query_functions"><a class="anchor" href="#_query_functions"></a>Query functions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Internet Computer terminology, all three <code>Counter</code> functions are <em>update</em> messages
that can alter the state of the canister when called. Effecting a state change requires
agreement amongst the distributed replicas before the Internet Computer can
commit the change and return a result. Reaching consensus is an
expensive process with relatively high latency.</p>
</div>
<div class="paragraph">
<p>For the parts of applications that don&#8217;t require the guarantees of consensus, the Internet Computer supports more efficient
<em>query</em> operations. These are able to read the state of a canister from a single replica,
modify a snapshot during their execution and return a result, but
cannot permanently alter the state or send further Internet Computer messages.</p>
</div>
<div class="paragraph">
<p>Motoko supports the implementation of Internet Computer queries using <code>query</code> functions. The <code>query</code> keyword
modifies the declaration of a (shared) actor function so that it executes with non-committing, and faster,
Internet Computer query semantics.</p>
</div>
<div class="paragraph">
<p>For example, we can extend the <code>Counter</code> actor with a fast-and-loose variant of the trustworthy <code>read</code> function, called <code>peek</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">actor Counter {

  var count = 0;

  // ...

  public shared query func peek() : async Nat {
    count
  };

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>peek()</code> function might be used by a <code>Counter</code> frontend offering a quick, but less trustworthy,
display of the current counter value.</p>
</div>
<div class="paragraph">
<p>It is a compile-time error for a query method to call an actor function since this would violate dynamic restrictions imposed by the Internet Computer. Calls to ordinary functions are permitted.</p>
</div>
<div class="paragraph">
<p>Query functions can be called from non-query functions. Because those nested calls require consensus,
the efficiency gains of nested query calls will be modest at best.</p>
</div>
<div class="paragraph">
<p>The <code>query</code> modifier is reflected in the type of a query function:</p>
</div>
<div class="listingblock no-repl">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">  peek : shared query () -&gt; async Nat</code></pre>
</div>
</div>
<div class="paragraph">
<p>As before, in <code>query</code> declarations and actor types the <code>shared</code> keyword can be omitted.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_messaging_restrictions"><a class="anchor" href="#_messaging_restrictions"></a>Messaging Restrictions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Internet Computer places restrictions on when and how canisters are allowed to communicate. These restrictions are enforced dynamically on the Internet Computer but prevented statically in Motoko, ruling out a class
of dynamic execution errors. Two examples are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>canister installation can execute code, but not send messages.</p>
</li>
<li>
<p>a canister query method cannot send messages.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These restrictions are surfaced in Motoko as restrictions on the context in which certain
expressions can be used.</p>
</div>
<div class="paragraph">
<p>In Motoko, an expression occurs in an <em>asynchronous context</em> if
it appears in the body of an <code>async</code> expression, which may be the body of a (shared or local) function or a stand-alone expression.
The only exception are <code>query</code> functions, whose body is not considered to open an asynchronous context.</p>
</div>
<div class="paragraph">
<p>In Motoko calling a shared function is an error unless the function is called in an asynchronouus context. In addition, calling a shared function from an actor class constructor is also an error.</p>
</div>
<div class="paragraph">
<p>The <code>await</code> construct is only allowed in an asynchronous context.</p>
</div>
<div class="paragraph">
<p>The <code>async</code> construct is only allowed in an asynchronous context.</p>
</div>
<div class="paragraph">
<p>It is only possible to <code>throw</code> or <code>try/catch</code> errors in an asynchronous context.
This is because structured error handling is supported for messaging errors only and,
like messaging itself, confined to asynchronous contexts.</p>
</div>
<div class="paragraph">
<p>These rules also mean that local functions cannot, in general, directly call shared functions or <code>await</code> futures. This limitation can sometimes be awkward:  we hope to extend the type system to be more permissive in future.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="actor_classes"><a class="anchor" href="#actor_classes"></a>Actor classes generalize actors</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An actor <em>class</em> generalizes a single actor declaration to the declaration of family of actors satisfying the same interface.
An actor class declares a type, naming the interface of its actors, and a function that
constructs a fresh actor of that type each time it is supplied with an argument.
An actor class thus serves as a factory for manufacturing actors.
Because canister installation is asynchronous on the Internet Computer, the constructor function is asynchronous too, and returns its actor in a future.</p>
</div>
<div class="paragraph">
<p>For example, we can generalize <code>Counter</code> given above to <code>Counter(init)</code>
below, by introducing a constructor parameter, variable <code>init</code> of type <code>Nat</code>:</p>
</div>
<div id="Counters" class="listingblock">
<div class="title">Counters.mo</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">actor class Counter(init : Nat) {
  var count = init;

  public func inc() : async () { count += 1 };

  public func read() : async Nat { count };

  public func bump() : async Nat {
    count += 1;
    count;
  };
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>If this class is stored in file <code>Counters.mo</code>, then
we can import the file as a module and use it to
create several actors with different initial values:</p>
</div>
<div class="listingblock include_Counters">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">import Counters "Counters";

let C1 = await Counters.Counter(1);
let C2 = await Counters.Counter(2);
(await C1.read(), await C2.read())</code></pre>
</div>
</div>
<div class="paragraph">
<p>The last two lines above <em>instantiate</em> the actor class twice.
The first invocation uses the initial value <code>1</code>, where the second uses initial value <code>2</code>.
Because actor class instantiation is asynchronous, each call to <code>Counter(init)</code> returns a future that can be <code>await</code>ed for the resulting actor value.
Both <code>C1</code> and <code>C2</code> have the same type, <code>Counters.Counter</code> and can be used interchangeably.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For now, the Motoko compiler gives an error when compiling
programs that do not consist of a single actor or actor class.
Compiled programs may still, however, reference imported actor classes.
For more information, see <a href="modules-and-imports.html#importing_actor_classes">Importing actor classes</a> and <a href="actor-classes.html#actor_classes">Actor classes</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
</article>
<aside class="toc sidebar">
  
  <div class="toc-menu"></div>
</aside></div>
</main>
</div>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<!--阿里图标库-->
<link rel="stylesheet" href="https://at.alicdn.com/t/font_3286973_o9mkce5aj7.css" />

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script type="text/javascript"> docsearch({
    appId: 'ZM55OFXXZ2',
    apiKey: 'a7d619461c99684e30dd0b3e9d375513',
    indexName: 'smartcontracts.org',
    inputSelector: '.search-input',
    debug: false // Set debug to true if you want to inspect the dropdown
});
</script>
<!--DFINITY帮助机器人-->
<!-- Start of dfinity Zendesk Widget script -->
<!--<script id="ze-snippet" src="https://static.zdassets.com/ekr/snippet.js?key=53121947-c10a-484c-b99b-f89a9fb6f63e"> </script>-->
<!-- End of dfinity Zendesk Widget script -->

<script src="../../_/js/vendor/run_repl.js"></script>
<script type="module">
  import {CodeJar} from 'https://cdn.jsdelivr.net/npm/codejar@3.2.3/codejar.min.js';
  import {withLineNumbers} from 'https://cdn.jsdelivr.net/npm/codejar@3.2.3/linenumbers.js';
  window.CodeJar = CodeJar;
  window.withLineNumbers = withLineNumbers;
</script>
<script type="text/javascript">
async function addPackage(name, repo, version, dir) {
  const meta_url = `../../_/js/vendor/${repo}/flat`;
  const base_url = `../../_/js/vendor/${repo}`;
  const response = await fetch(meta_url);
  const json = await response.json()
  const promises = [];
  const fetchedFiles = [];
  for (const f of json.files) {
    if (f.name.startsWith(`/${dir}/`) && /\.mo$/.test(f.name)) {
      const promise = (async () => {
        const content = await (await fetch(base_url + f.name)).text();
        const stripped = name + f.name.slice(dir.length + 1);
        fetchedFiles.push(stripped);
        Motoko.saveFile(stripped, content);
      })();
      promises.push(promise);
    }
  }
  Promise.all(promises).then(() => {
    Motoko.addPackage(name, name + '/');
    console.log(`Loaded motoko library "${name}"`);
    changeCodeBlock(); // from run_repl.js
  });
}
function loadBase() {
  addPackage('base', 'dfinity/motoko-base', 'dfx-0.6.18', 'src');
}
</script>
<script async src="../../_/js/moc/moc-interpreter-0.6.11.js" onload="loadBase()">
</script>
  </body>
</html>
